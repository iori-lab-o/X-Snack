# X-Snack ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸

## ğŸ“Œ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

**X-Snack** ã¯ã€Expo (React Native) ã¨ Cloudflare Workers (Hono) ã‚’çµ„ã¿åˆã‚ã›ãŸãƒãƒ«ãƒãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚Xé¢¨ã®è¦ç´„AIæ©Ÿèƒ½ã‚’ä¸­æ ¸ã¨ã—ã€iOS/Android/Web ã§å‹•ä½œã—ã¾ã™ã€‚

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½

### 1. Xé¢¨è¦ç´„AI (Summarize API)

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/summarize`

**æ©Ÿèƒ½æ¦‚è¦**:
- é•·æ–‡ãƒ†ã‚­ã‚¹ãƒˆã‚’Xï¼ˆæ—§Twitterï¼‰é¢¨ã®çŸ­æ–‡ã«è¦ç´„
- ãƒãƒ«ãƒãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆGemini â†’ Workers AI â†’ Hugging Face â†’ Mockï¼‰
- IPãƒ™ãƒ¼ã‚¹ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆ10å›/æ—¥ï¼‰
- æ®‹ã‚Šä½¿ç”¨å›æ•°ã®è¡¨ç¤º

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:

\`\`\`typescript
{
  text: string;  // è¦ç´„å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæœ€å¤§10000æ–‡å­—ï¼‰
}
\`\`\`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:

\`\`\`typescript
{
  summary: string;           // è¦ç´„çµæœï¼ˆ140æ–‡å­—ä»¥å†…ï¼‰
  provider: 'gemini' | 'workers-ai' | 'huggingface' | 'mock';
  remainingCount: number;    // æœ¬æ—¥ã®æ®‹ã‚Šä½¿ç”¨å›æ•°
}
\`\`\`

**ãƒ¬ãƒ¼ãƒˆåˆ¶é™**:
- åˆ¶é™: 10å›/æ—¥ï¼ˆIPå˜ä½ï¼‰
- ãƒªã‚»ãƒƒãƒˆ: æ¯æ—¥0:00 UTC
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: Cloudflare KVï¼ˆTTL: 24æ™‚é–“ï¼‰

**AIãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å„ªå…ˆé †ä½**:

1. **Gemini 1.5 Flash** (ç¬¬1å„ªå…ˆ)
   - API: Google AI Studio
   - åˆ¶é™: 15 RPM, 1M TPM, 1500 RPDï¼ˆç„¡æ–™æ ï¼‰
   - ç’°å¢ƒå¤‰æ•°: \`GEMINI_API_KEY\`

2. **Workers AI** (ç¬¬2å„ªå…ˆ)
   - ãƒ¢ãƒ‡ãƒ«: \`@cf/meta/llama-3-8b-instruct\`
   - åˆ¶é™: 10,000 Neurons/æ—¥ï¼ˆç„¡æ–™æ ï¼‰
   - ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°: \`AI\`

3. **Hugging Face** (ç¬¬3å„ªå…ˆ)
   - ãƒ¢ãƒ‡ãƒ«: \`facebook/bart-large-cnn\`
   - ãƒˆãƒ¼ã‚¯ãƒ³: ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆãªã—ã§ã‚‚å‹•ä½œï¼‰
   - ç’°å¢ƒå¤‰æ•°: \`HUGGINGFACE_API_TOKEN\`

4. **Mock** (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯)
   - å…¨ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¤±æ•—æ™‚ã®ãƒ€ãƒŸãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

### 2. ã‚µãƒ³ãƒ—ãƒ«API

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- \`GET /\`: APIæƒ…å ±
- \`GET /api/greeting\`: æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- \`GET /api/users\`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
- \`GET /api/users/:id\`: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°
- \`POST /api/users\`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
- \`GET /health\`: ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

\`\`\`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client (Web)  â”‚ (Expo Web)
â”‚  localhost:8081 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API (Cloudflare Workers)   â”‚
â”‚      localhost:8787         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Hono Framework           â”‚
â”‚  â€¢ CORS Middleware          â”‚
â”‚  â€¢ Rate Limit (KV)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KV Storeâ”‚ â”‚  AI Services â”‚
â”‚(Rate    â”‚ â”‚ â€¢ Gemini     â”‚
â”‚ Limit)  â”‚ â”‚ â€¢ Workers AI â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â€¢ Hugging Faceâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
\`\`\`

### ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ

\`\`\`
expo-workers-monorepo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ api/                 # Cloudflare Workers API
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts     # APIã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆï¼ˆHonoï¼‰
â”‚   â”‚   â”œâ”€â”€ test/            # Vitest ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ wrangler.jsonc   # Workersè¨­å®šï¼ˆKV, AIï¼‰
â”‚   â”‚   â””â”€â”€ .dev.vars        # ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒå¤‰æ•°
â”‚   â””â”€â”€ client/              # Expo ã‚¢ãƒ—ãƒª
â”‚       â”œâ”€â”€ lib/
â”‚       â”‚   â”œâ”€â”€ apiClient.ts # API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚       â”‚   â””â”€â”€ theme.ts     # ãƒ†ãƒ¼ãƒå®šæ•°
â”‚       â”œâ”€â”€ __tests__/       # Vitest ãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ App.tsx          # ãƒ¡ã‚¤ãƒ³UI
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ types/               # å…±æœ‰å‹å®šç¾©
â”‚       â””â”€â”€ src/
â”‚           â””â”€â”€ index.ts     # TypeScriptå‹
â”œâ”€â”€ e2e/                     # Playwright E2Eãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ app.spec.ts
â”‚   â””â”€â”€ summary.spec.ts
â””â”€â”€ .github/workflows/
    â”œâ”€â”€ ci.yml               # CIï¼ˆãƒ†ã‚¹ãƒˆï¼‰
    â””â”€â”€ deploy.yml           # CDï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
\`\`\`

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### API (apps/api)
- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **: Cloudflare Workers
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Hono 4.10+
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Cloudflare KV
- **AI**: Workers AI, Gemini, Hugging Face
- **ãƒ†ã‚¹ãƒˆ**: Vitest

### Client (apps/client)
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Expo ~54.0
- **UI**: React 19.1 + React Native 0.81
- **è¨€èª**: TypeScript ~5.9
- **ãƒ†ã‚¹ãƒˆ**: Vitest + React Testing Library

### å…±é€š
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: pnpm 10.20
- **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹**: pnpm workspace
- **Linter/Formatter**: Biome
- **E2E**: Playwright

### CI/CD
- **CI**: GitHub Actionsï¼ˆè‡ªå‹•ãƒ†ã‚¹ãƒˆï¼‰
- **CD**: GitHub Actions + Wranglerï¼ˆè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰

## ğŸ” ç’°å¢ƒå¤‰æ•°

### Client (.env)

\`\`\`bash
EXPO_PUBLIC_HONO_API_URL=http://localhost:8787  # é–‹ç™º
# EXPO_PUBLIC_HONO_API_URL=https://your-api.workers.dev  # æœ¬ç•ª
\`\`\`

### API (Cloudflare Workers)

**ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º** (.dev.vars):

\`\`\`bash
GEMINI_API_KEY=your_key_here
HUGGINGFACE_API_TOKEN=your_token_here  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³
ALLOWED_ORIGINS=http://localhost:8081
\`\`\`

**æœ¬ç•ªç’°å¢ƒ** (wrangler secret):

\`\`\`bash
pnpm wrangler secret put GEMINI_API_KEY
pnpm wrangler secret put HUGGINGFACE_API_TOKEN
pnpm wrangler secret put ALLOWED_ORIGINS
\`\`\`

**wrangler.jsonc**:

\`\`\`jsonc
{
  "name": "expo-workers-api",
  "main": "src/index.ts",
  "compatibility_date": "2024-01-01",
  "kv_namespaces": [
    {
      "binding": "RATE_LIMIT_KV",
      "id": "your_kv_id"
    }
  ],
  "ai": {
    "binding": "AI"
  }
}
\`\`\`

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- **API**: Vitestï¼ˆ\`apps/api/test\`ï¼‰
  - API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: \`index.spec.ts\`
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†: \`users.spec.ts\`
- **Client**: Vitestï¼ˆ\`apps/client/__tests__\`ï¼‰
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: \`App.test.tsx\`

### E2Eãƒ†ã‚¹ãƒˆ
- **Playwright**: \`e2e/\`
  - åŸºæœ¬å‹•ä½œ: \`app.spec.ts\`
  - è¦ç´„æ©Ÿèƒ½: \`summary.spec.ts\`
- **å¯¾è±¡**: Webç‰ˆã®ã¿ï¼ˆlocalhost:8081ï¼‰

### CI
- **GitHub Actions**: \`.github/workflows/ci.yml\`
  - API ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
  - Client ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
  - E2E ãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### è¦ç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼

\`\`\`
1. Client (App.tsx)
   â†“ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
2. apiClient.summarize(text)
   â†“ POST /api/summarize
3. API (index.ts)
   â”œâ”€ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼ˆKVï¼‰
   â”‚  â”œâ”€ OK â†’ ç¶šè¡Œ
   â”‚  â””â”€ NG â†’ 429 Too Many Requests
   â”œâ”€ Gemini API å‘¼ã³å‡ºã—
   â”‚  â”œâ”€ æˆåŠŸ â†’ provider='gemini'
   â”‚  â””â”€ å¤±æ•— â†’ æ¬¡ã¸
   â”œâ”€ Workers AI å‘¼ã³å‡ºã—
   â”‚  â”œâ”€ æˆåŠŸ â†’ provider='workers-ai'
   â”‚  â””â”€ å¤±æ•— â†’ æ¬¡ã¸
   â”œâ”€ Hugging Face API å‘¼ã³å‡ºã—
   â”‚  â”œâ”€ æˆåŠŸ â†’ provider='huggingface'
   â”‚  â””â”€ å¤±æ•— â†’ Mock
   â””â”€ Mock ãƒ¬ã‚¹ãƒãƒ³ã‚¹
      â””â”€ provider='mock'
4. KVã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
5. Client ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹
   â†“
6. UI æ›´æ–°ï¼ˆè¦ç´„è¡¨ç¤º + æ®‹å›æ•°ï¼‰
\`\`\`

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤

### å‰ææ¡ä»¶
1. Cloudflare ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
2. GitHub Secrets è¨­å®š:
   - \`CLOUDFLARE_API_TOKEN\`
   - \`CLOUDFLARE_ACCOUNT_ID\`

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼
1. \`main\` ãƒ–ãƒ©ãƒ³ãƒã¸ãƒ—ãƒƒã‚·ãƒ¥
2. GitHub Actions ãƒˆãƒªã‚¬ãƒ¼
3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆCIï¼‰
4. \`pnpm wrangler deploy\`ï¼ˆCDï¼‰
5. ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†

è©³ç´°: [DEPLOY.md](DEPLOY.md)

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### CORS
- é–‹ç™º: \`http://localhost:8081\` ã®ã¿è¨±å¯
- æœ¬ç•ª: \`ALLOWED_ORIGINS\` ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡

### ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- IP ãƒ™ãƒ¼ã‚¹: 10å›/æ—¥
- KV ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: è‡ªå‹•å‰Šé™¤ï¼ˆTTL: 24hï¼‰
- åŒ¿ååŒ–: IP ã¯ KV ã‚­ãƒ¼ã®ä¸€éƒ¨ã¨ã—ã¦ã®ã¿ä½¿ç”¨

### API ã‚­ãƒ¼ç®¡ç†
- Cloudflare Secrets ã§æš—å·åŒ–ä¿å­˜
- ãƒªãƒã‚¸ãƒˆãƒªã«ã¯ \`.dev.vars.example\` ã®ã¿ã‚³ãƒŸãƒƒãƒˆ

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ç›®æ¨™
- API ãƒ¬ã‚¹ãƒãƒ³ã‚¹: < 2ç§’ï¼ˆè¦ç´„å«ã‚€ï¼‰
- Web ã‚¢ãƒ—ãƒªåˆå›èª­ã¿è¾¼ã¿: < 3ç§’
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯: < 50ms

### æœ€é©åŒ–
- Cloudflare Workers: ã‚¨ãƒƒã‚¸ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰
- KV ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: é«˜é€Ÿèª­ã¿æ›¸ã
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ãªã—ï¼ˆé«˜é€Ÿå¤±æ•—ï¼‰

## ğŸ› ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™: æ®‹ã‚Šå›æ•°ã¨æ¬¡å›ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ã‚’è¡¨ç¤º
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›åˆ¶é™

### API
- AI ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¤±æ•—: è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- KV ã‚¨ãƒ©ãƒ¼: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’ç·©å’Œï¼ˆfail-openï¼‰
- ä¸æ­£ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: 400 Bad Request

## ğŸ”„ ä»Šå¾Œã®æ‹¡å¼µ

### Phase 1ï¼ˆå®Œäº†ï¼‰
- [x] åŸºæœ¬APIå®Ÿè£…
- [x] è¦ç´„AIæ©Ÿèƒ½
- [x] ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- [x] E2Eãƒ†ã‚¹ãƒˆ

### Phase 2ï¼ˆæœªç€æ‰‹ï¼‰
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ï¼ˆJWTï¼‰
- [ ] è¦ç´„å±¥æ­´ä¿å­˜ï¼ˆD1ï¼‰
- [ ] ã‚«ã‚¹ã‚¿ãƒ è¦ç´„ã‚¹ã‚¿ã‚¤ãƒ«
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªé…ä¿¡

### Phase 3ï¼ˆæ¤œè¨ä¸­ï¼‰
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¦ç´„ï¼ˆWebSocketï¼‰
- [ ] å¤šè¨€èªå¯¾å¿œ
- [ ] éŸ³å£°å…¥åŠ›
- [ ] Chromeæ‹¡å¼µæ©Ÿèƒ½

---

**æœ€çµ‚æ›´æ–°**: 2025-12-12
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
